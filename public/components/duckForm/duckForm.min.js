"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,a){function n(t){t.stopPropagation(),t.preventDefault(),e(this).closest("[duck-type]").remove()}function i(t){t.stopPropagation(),t.preventDefault();var a=e(this),c=a.attr("duck-add"),r=a.closest('[duck-type="array"]'),d=r.find("[duck-type]").first(),o=d.parent().find("> [duck-type]").last(),u=d.clone();switch(u.find('[duck-value], [duck-type="wysiwyg"]').val(null),u.find('[duck-button="delete"]').click(n),u.find('[data-function="tabs"]').makeTabs(),"object"===d.attr("duck-type")&&(u.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),u.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote({height:150}),u.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove(),u.find('[duck-button="add"]').click(i)),c){case"after":a.closest("[duck-type]").after(u);break;case"before":a.closest("[duck-type]").before(u);break;default:o.after(u)}d.parent().sortable("[duck-type]")}function c(e,t,a){for(var n="string"==typeof t?t.split("."):t,i=n.length,r=function(t){var r=n[t],d=1===i,o="object"===_typeof(e[r]);if(d&&!o)delete e[r];else if(!o)return"break";var u=e[r]instanceof Array?"array":"object";if("object"===u){var l=n.slice(0);l.splice(0,1),e[r]=c(e[r],l,a)}else{var f=d?e[r].indexOf(a):e[r].map(function(e){return e[n[t+1]]}).indexOf(a);e[r].splice(f,1)}},d=0;d<i;d++){var o=r(d);if("break"===o)break}return e}function r(e,a,n,i){var c=a.attr("duck-key"),r=e[n]||{};c&&!r[c]&&(r[c]=a.attr("duck-key-value")||t.uuid()),e[n]=i(r,t.findRelevantChildren(a,"[duck-field]"))}function d(a,n,i,c){var r=t.findRelevantChildren(n,'[duck-type="object"]'),d=r.first().attr("duck-key")?a[i]||[]:[];r.length?r.each(function(a,n){var i=e(n),r=i.attr("duck-key"),o=i.attr("duck-key-value")||t.uuid(),u=r?d.filter(function(e){return e[r]===o})[0]||{}:{};if(r){u[r]=o;var l=d.map(function(e){return e[r]}).indexOf(u[r]);l!==-1&&d.splice(l,1)}d.push(c(u,t.findRelevantChildren(i,"[duck-field]")))}):n.find("[duck-value]").each(function(t,a){var n=e(a).val();n&&d.push(n)}),(a[i]||d.length)&&(a[i]=d)}function o(t,a,n){var i=[];a.find('input[type="checkbox"]').each(function(t,a){var n=e(a);n.prop("checked")&&i.push(n.val())}),(t[n]||i.length)&&(t[n]=i)}function u(e,t,a){var n=t.find('input[type="radio"]:checked').val();(e[a]||n)&&(e[a]=n)}function l(e,t,a,n){var i=n||".summernote",c=t.find(i).summernote("code");c&&(e[a]=c)}function f(t,a){return a.each(function(a,n){var i=e(n),c=i.attr("duck-field"),s=i.attr("duck-type");switch(s){case"object":r(t,i,c,f);break;case"array":d(t,i,c,f);break;case"checkbox":o(t,i,c);break;case"radio":u(t,i,c);break;case"bool":t[c]=i.prop("checked")||i.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":l(t,i,c);break;case"image":case"select":case"number":case"string":default:var p=i.val(),k=p?p:i.find("[duck-value]").val();(t[c]||k)&&(t[c]=k)}}),t}function s(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase())})}function p(e,a,n,i,c,r){var d={};d[a]=n||t.uuid(),t(e).add(f(d,i),c,r)}function k(e,a,n,i,c,r){t(e).get({field:a,value:n,findOne:!0},function(a){var n=f(a,i);t(e).update(n,c,r)})}function g(e,n,i,c){t(e).delete(i,function(){var e=a.location.href.split("/"),t=c.attr("duck-goTo");e[e.length-1]?e.pop():(e.pop(),e.pop());var n=t?t:e.join("/");a.location.href===n?a.location.reload(!0):a.location.href=n})}function v(e,a,n,i,r,d){var o=i.attr("duck-delete-path"),u=i.attr("duck-delete-value");t(e).get({field:a,value:n,findOne:!0},function(a){var n=c(a,o,u);t(e).update(n,r,d)})}function y(t){var a=t.data.wrapper;a.attr("duck-edit-form","view"===a.attr("duck-edit-form")?"edit":"view"),e('[data-function*="scroll"]').trigger("initScroll")}function b(t){t.preventDefault(),t.stopPropagation();var a=t.data.crud,n=t.data.table,i=t.data.key,c=t.data.keyValue,r=t.data.startOfFields,d=t.data.wrapper,o=t.data.successCallback,u=t.data.failureCallBack;switch(e(t.currentTarget).prop("disabled",!0),a){case"add":p(n,i,c,r,o,u);break;case"update":k(n,i,c,r,o,u);break;case"delete":g(n,i,c,d);break;case"deleteField":v(n,i,c,d,o,u)}}function m(t){var a=e("<img/>",{src:"https://s3-us-west-2.amazonaws.com/lissnerlistner.com/"+t,alt:t,"duck-image-value":t.replace("-thumb2","").replace("images/",""),click:function(t){t.stopPropagation();var a=e(t.currentTarget);a.parent().find("img").attr("image-selected","false").removeClass("bw-Lg bc-Purp bs-S"),a.attr("image-selected","true").addClass("bw-Lg bc-Purp bs-S")}});return a}function h(c,r){var d=e(c),o=t.findRelevantChildren(d,"[duck-field]"),u=d.find('[duck-button="edit"]'),l=d.find('[duck-button="cancel"]'),f=r&&r.table||d.attr("duck-table"),p=r&&r.crud||d.attr("duck-function"),k=r&&r.key||d.attr("duck-key"),g=r&&r.keyValue||d.attr("duck-key-value"),v=d.find('[duck-field="url"] input'),h=r&&r.successCallback||function(){a.location.reload(!0)},w=r&&r.failureCallBack||function(){a.location.reload(!0)};v.length&&s(v,d.find('[duck-field="names"] input')),f&&p&&k&&("update"!==p&&"delete"!==p||g)&&(u.off("click",y).on("click",{wrapper:d},y),l.off("click",y).on("click",{wrapper:d},y),d.off("click",b).on("click",'[duck-button="submit"]',{crud:p,table:f,key:k,keyValue:g,wrapper:d,startOfFields:o,successCallback:h,failureCallBack:w},b),d.find('[duck-type="array"]').each(function(a,n){var i=e(n),c=t.findRelevantChildren(i,"[duck-type]");c.first().parent().sortable("[duck-type]")}),d.find('[duck-button="add"]').off("click",i).click(i),d.find('[duck-button="delete"]').off("click",n).click(n),d.find('[duck-type="image"]').each(function(t,a){var n=e(a),i=n.find('input[type="file"]'),c=n.find("[duck-image-picker]").detach();e(".site-body").append(c);var r=c.find('[duck-button="upload"]'),d=c.find('[duck-button="save-image"]'),o=c.find("[duck-images]"),u={fileUploading:function(e){e.stopPropagation(),r.attr("disabled",!0).html('<i class="fa fa-spinner fa-spin"></i> Uploading...')},filesUploaded:function(e,t){return e.stopPropagation(),r.attr("disabled",!1).text(t?"Try Again":"Upload Another Image"),t?void o.text("Sorry, something went wrong uploading your image."):(o.attr("duck-images",!1),void n.trigger("getFiles"))},gettingFiles:function(e){e.stopPropagation(),c.find(".modal").modal("show"),"false"===o.attr("duck-images")&&o.html('<div class="p-Xl ta-C js-waiting"><i class="fa fa-spinner fa-spin"></div>')},gotFiles:function(e,t,a){if(t||!a||!a.length)return void o.text("Sorry, something went wrong getting the images.");if("false"===o.attr("duck-images")){var n=a.filter(function(e){return e.Key.indexOf("-thumb2.")>-1}).sort(function(e,t){return e.LastModified>t.LastModified?-1:e.LastModified<t.LastModified?1:0}),i=n.length;o.find(".js-waiting").addClass("hidden");for(var c=0;c<i;c++)o.append(m(n[c].Key));o.attr("duck-images",!0)}}};n.find('[duck-button="image-select"]').on("click",function(){n.trigger("getFiles")}),r.on("click",function(){i.click()}),i.on("change",function(){n.trigger("uploadFiles")}),d.on("click",function(e){e.stopPropagation(),e.preventDefault(),c.find(".modal").modal("hide"),n.find("[duck-image-value]").text(o.find('[image-selected="true"]').attr("duck-image-value"))}),n.filePicker(u)}))}e.fn.duckForm=function(e){return this.each(function(t,a){h(a,e)})},e(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=duckForm.min.js.map
