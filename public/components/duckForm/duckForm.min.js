"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,n){function c(){e(this).parent().remove()}function a(){var t=e(this),n=t.parent(),i=n.find("> [duck-type]").first(),u=i.clone();u.find("[duck-value]").val(null),"object"===i.attr("duck-type")&&(u.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),u.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote({height:150}),u.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove()),u.append(e("<button>",{text:"Delete",class:"btn btn-danger btn-small","duck-button":"add",type:"button",click:c})),u.find('[duck-button="add"]').click(a),t.before(u)}function i(e,t,n){for(var c="string"==typeof t?t.split("."):t,a=c.length,u=function(t){var u=c[t],r=1===a,d="object"===_typeof(e[u]);if(r&&!d)delete e[u];else if(!d)return"break";var o=e[u]instanceof Array?"array":"object";if("object"===o){var f=c.slice(0);f.splice(0,1),e[u]=i(e[u],f,n)}else{var l=r?e[u].indexOf(n):e[u].map(function(e){return e[c[t+1]]}).indexOf(n);e[u].splice(l,1)}},r=0;r<a;r++){var d=u(r);if("break"===d)break}return e}function u(e,n,c,a){var i=n.attr("duck-key"),u=e[c]||{};i&&!u[i]&&(u[i]=n.attr("duck-key-value")||t.uuid()),e[c]=a(u,n.find("> [duck-field]"))}function r(n,c,a,i){var u=c.find('> [duck-type="object"]'),r=u.first().attr("duck-key")?n[a]:[];u.length?u.each(function(n,c){var a=e(c),u=a.attr("duck-key"),d=a.attr("duck-key-value")||t.uuid(),o=u?r.filter(function(e){return e[u]===d})[0]:{};if(u){o[u]=d;var f=r.map(function(e){return e[u]}).indexOf(o[u]);f!==-1&&r.splice(f,1)}r.push(i(o,a.find("> [duck-field]")))}):c.find("[duck-value]").each(function(t,n){var c=e(n).val();c&&r.push(c)}),(n[a]||r.length)&&(n[a]=r)}function d(t,n,c){var a=[];n.find('input[type="checkbox"]').each(function(t,n){var c=e(n);c.prop("checked")&&a.push(c.val())}),(t[c]||a.length)&&(t[c]=a)}function o(e,t,n){var c=t.find('input[type="radio"]:checked').val();(e[n]||c)&&(e[n]=c)}function f(e,t,n,c){var a=c||".summernote",i=t.find(a).summernote("code");i&&(e[n]=i)}function l(t,n){return n.each(function(n,c){var a=e(c),i=a.attr("duck-field"),k=a.attr("duck-type");switch(k){case"object":u(t,a,i,l);break;case"array":r(t,a,i,l);break;case"checkbox":d(t,a,i);break;case"radio":o(t,a,i);break;case"bool":t[i]=a.prop("checked")||a.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":f(t,a,i);break;case"image":case"select":case"number":case"string":default:var p=a.val(),s=p?p:a.find("[duck-value]").val();(t[i]||s)&&(t[i]=s)}}),t}function k(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase())})}function p(u,r){var d=e(u),o=d.find("> [duck-field]"),f=d.find('[duck-button="edit"]'),p=d.find('[duck-button="cancel"]'),s=r&&r.table||d.attr("duck-table"),b=r&&r.crud||d.attr("duck-function"),v=r&&r.key||d.attr("duck-key"),y=r&&r.keyValue||d.attr("duck-key-value"),m=d.find('[duck-field="url"] input'),h=r&&r.successCallback||function(){n.location.reload(!0)},g=r&&r.failureCallBack||function(){n.location.reload(!0)};m.length&&k(m,d.find('[duck-field="names"] [duck-field="display"] input')),s&&b&&v&&("update"!==b&&"delete"!==b||y)&&(f.click(function(){d.attr("duck-edit-form","view"===d.attr("duck-edit-form")?"edit":"view")}),p.click(function(){d.attr("duck-edit-form","view"===d.attr("duck-edit-form")?"edit":"view")}),d.on("click",'[duck-button="submit"]',function(c){switch(c.preventDefault(),c.stopPropagation(),e(c.currentTarget).prop("disabled",!0),b){case"add":var a={};a[v]=y||t.uuid(),t(s).add(l(a,o),h,g);break;case"update":t(s).get({field:v,value:y,findOne:!0},function(e){var n=l(e,o);t(s).update(n,h,g)});break;case"delete":t(s).delete(y,function(){var e=n.location.href.split("/"),t=d.attr("duck-goTo");e[e.length-1]?e.pop():(e.pop(),e.pop());var c=t?t:e.join("/");n.location.href===c?n.location.reload(!0):n.location.href=c});break;case"deleteField":var u=function(){var e=d.attr("duck-delete-path"),n=d.attr("duck-delete-value");return t(s).get({field:v,value:y,findOne:!0},function(c){var a=i(c,e,n);t(s).update(a,h,g)}),"break"}();if("break"===u)break}}),d.find('[duck-type="array"]').each(function(t,n){var i=e(n),u=e("<button>",{text:"Add "+i.attr("duck-field"),class:"btn btn-primary btn-small","duck-button":"add",type:"button",click:a});i.append(u),i.find("> [duck-type]").each(function(t,n){if(0!==t){var a=e(n),i=e("<button>",{text:"Delete",class:"btn btn-danger btn-small","duck-button":"delete",click:c});a.append(i)}})}))}e.fn.duckForm=function(e){return this.each(function(t,n){p(n,e)})},e(n).on("load",function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=duckForm.min.js.map
