"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,c){function n(t){t.stopPropagation(),e(this).closest("[duck-type]").remove()}function a(){var t=e(this),c=t.attr("duck-add"),i=t.closest('[duck-type="array"]'),r=i.find("[duck-type]").first(),u=r.parent().find("> [duck-type]").last(),d=r.clone();switch(d.find('[duck-value], [duck-type="wysiwyg"]').val(null),d.find('[duck-button="delete"]').click(n),d.find('[data-function="tabs"]').makeTabs(),"object"===r.attr("duck-type")&&(d.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),d.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote({height:150}),d.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove(),d.find('[duck-button="add"]').click(a)),c){case"after":t.closest("[duck-type]").after(d);break;case"before":t.closest("[duck-type]").before(d);break;default:u.after(d)}r.parent().sortable("[duck-type]")}function i(e,t,c){for(var n="string"==typeof t?t.split("."):t,a=n.length,r=function(t){var r=n[t],u=1===a,d="object"===_typeof(e[r]);if(u&&!d)delete e[r];else if(!d)return"break";var o=e[r]instanceof Array?"array":"object";if("object"===o){var f=n.slice(0);f.splice(0,1),e[r]=i(e[r],f,c)}else{var l=u?e[r].indexOf(c):e[r].map(function(e){return e[n[t+1]]}).indexOf(c);e[r].splice(l,1)}},u=0;u<a;u++){var d=r(u);if("break"===d)break}return e}function r(e,c,n,a){var i=c.attr("duck-key"),r=e[n]||{};i&&!r[i]&&(r[i]=c.attr("duck-key-value")||t.uuid()),e[n]=a(r,t.findRelevantChildren(c,"[duck-field]"))}function u(c,n,a,i){var r=t.findRelevantChildren(n,'[duck-type="object"]'),u=r.first().attr("duck-key")?c[a]:[];r.length?r.each(function(c,n){var a=e(n),r=a.attr("duck-key"),d=a.attr("duck-key-value")||t.uuid(),o=r?u.filter(function(e){return e[r]===d})[0]:{};if(r){o[r]=d;var f=u.map(function(e){return e[r]}).indexOf(o[r]);f!==-1&&u.splice(f,1)}u.push(i(o,t.findRelevantChildren(a,"[duck-field]")))}):n.find("[duck-value]").each(function(t,c){var n=e(c).val();n&&u.push(n)}),(c[a]||u.length)&&(c[a]=u)}function d(t,c,n){var a=[];c.find('input[type="checkbox"]').each(function(t,c){var n=e(c);n.prop("checked")&&a.push(n.val())}),(t[n]||a.length)&&(t[n]=a)}function o(e,t,c){var n=t.find('input[type="radio"]:checked').val();(e[c]||n)&&(e[c]=n)}function f(e,t,c,n){var a=n||".summernote",i=t.find(a).summernote("code");i&&(e[c]=i)}function l(t,c){return c.each(function(c,n){var a=e(n),i=a.attr("duck-field"),k=a.attr("duck-type");switch(k){case"object":r(t,a,i,l);break;case"array":u(t,a,i,l);break;case"checkbox":d(t,a,i);break;case"radio":o(t,a,i);break;case"bool":t[i]=a.prop("checked")||a.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":f(t,a,i);break;case"image":case"select":case"number":case"string":default:var p=a.val(),s=p?p:a.find("[duck-value]").val();(t[i]||s)&&(t[i]=s)}}),t}function k(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase())})}function p(r,u){var d=e(r),o=t.findRelevantChildren(d,"[duck-field]"),f=d.find('[duck-button="edit"]'),p=d.find('[duck-button="cancel"]'),s=u&&u.table||d.attr("duck-table"),v=u&&u.crud||d.attr("duck-function"),y=u&&u.key||d.attr("duck-key"),b=u&&u.keyValue||d.attr("duck-key-value"),h=d.find('[duck-field="url"] input'),m=u&&u.successCallback||function(){c.location.reload(!0)},g=u&&u.failureCallBack||function(){c.location.reload(!0)};h.length&&k(h,d.find('[duck-field="name"] input')),s&&v&&y&&("update"!==v&&"delete"!==v||b)&&(f.click(function(){d.attr("duck-edit-form","view"===d.attr("duck-edit-form")?"edit":"view")}),p.click(function(){d.attr("duck-edit-form","view"===d.attr("duck-edit-form")?"edit":"view")}),d.on("click",'[duck-button="submit"]',function(n){switch(n.preventDefault(),n.stopPropagation(),e(n.currentTarget).prop("disabled",!0),v){case"add":var a={};a[y]=b||t.uuid(),t(s).add(l(a,o),m,g);break;case"update":t(s).get({field:y,value:b,findOne:!0},function(e){var c=l(e,o);t(s).update(c,m,g)});break;case"delete":t(s).delete(b,function(){var e=c.location.href.split("/"),t=d.attr("duck-goTo");e[e.length-1]?e.pop():(e.pop(),e.pop());var n=t?t:e.join("/");c.location.href===n?c.location.reload(!0):c.location.href=n});break;case"deleteField":var r=function(){var e=d.attr("duck-delete-path"),c=d.attr("duck-delete-value");return t(s).get({field:y,value:b,findOne:!0},function(n){var a=i(n,e,c);t(s).update(a,m,g)}),"break"}();if("break"===r)break}}),d.find('[duck-type="array"]').each(function(t,c){var i=e(c),r=i.find('[duck-button="add"]');r.off("click",a).click(a),i.find("> [duck-type]").each(function(t,c){var a=e(c),i=a.find('[duck-button="delete"]');i.off("click",n).click(n)})}).sortable("[duck-type]"))}e.fn.duckForm=function(e){return this.each(function(t,c){p(c,e)})},e(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=duckForm.min.js.map
