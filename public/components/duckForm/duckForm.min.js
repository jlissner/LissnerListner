"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,n){function c(t){t.stopPropagation(),e(this).closest("[duck-type]").remove()}function o(){var n=e(this),a=n.attr("duck-add"),r=n.closest('[duck-type="array"]'),u=r.find("[duck-type]").first(),i=u.parent().find("> [duck-type]").last(),d=u.clone();switch(d.find('[duck-value], [duck-type="wysiwyg"]').val(null).on("mousedown",t.stopProp),d.find('[duck-button="delete"]').click(c).on("mousedown",t.stopProp),"object"===u.attr("duck-type")&&(d.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),d.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote({height:150}),d.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove(),d.find('[duck-button="add"]').click(o)),a){case"after":n.closest("[duck-type]").after(d);break;case"before":n.closest("[duck-type]").before(d);break;default:i.after(d)}u.parent().sortable("[duck-type]")}function a(e,t,n){for(var c="string"==typeof t?t.split("."):t,o=c.length,r=function(t){var r=c[t],u=1===o,i="object"===_typeof(e[r]);if(u&&!i)delete e[r];else if(!i)return"break";var d=e[r]instanceof Array?"array":"object";if("object"===d){var f=c.slice(0);f.splice(0,1),e[r]=a(e[r],f,n)}else{var l=u?e[r].indexOf(n):e[r].map(function(e){return e[c[t+1]]}).indexOf(n);e[r].splice(l,1)}},u=0;u<o;u++){var i=r(u);if("break"===i)break}return e}function r(e,n,c,o){var a=n.attr("duck-key"),r=e[c]||{};a&&!r[a]&&(r[a]=n.attr("duck-key-value")||t.uuid()),e[c]=o(r,t.findRelevantChildren(n,"[duck-field]"))}function u(n,c,o,a){var r=c.find('> [duck-type="object"]'),u=r.first().attr("duck-key")?n[o]:[];r.length?r.each(function(n,c){var o=e(c),r=o.attr("duck-key"),i=o.attr("duck-key-value")||t.uuid(),d=r?u.filter(function(e){return e[r]===i})[0]:{};if(r){d[r]=i;var f=u.map(function(e){return e[r]}).indexOf(d[r]);f!==-1&&u.splice(f,1)}u.push(a(d,t.findRelevantChildren(o,"[duck-field]")))}):c.find("[duck-value]").each(function(t,n){var c=e(n).val();c&&u.push(c)}),(n[o]||u.length)&&(n[o]=u)}function i(t,n,c){var o=[];n.find('input[type="checkbox"]').each(function(t,n){var c=e(n);c.prop("checked")&&o.push(c.val())}),(t[c]||o.length)&&(t[c]=o)}function d(e,t,n){var c=t.find('input[type="radio"]:checked').val();(e[n]||c)&&(e[n]=c)}function f(e,t,n,c){var o=c||".summernote",a=t.find(o).summernote("code");a&&(e[n]=a)}function l(t,n){return n.each(function(n,c){var o=e(c),a=o.attr("duck-field"),k=o.attr("duck-type");switch(k){case"object":r(t,o,a,l);break;case"array":u(t,o,a,l);break;case"checkbox":i(t,o,a);break;case"radio":d(t,o,a);break;case"bool":t[a]=o.prop("checked")||o.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":f(t,o,a);break;case"image":case"select":case"number":case"string":default:var p=o.val(),s=p?p:o.find("[duck-value]").val();(t[a]||s)&&(t[a]=s)}}),t}function k(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase())})}function p(r,u){var i=e(r),d=t.findRelevantChildren(i,"[duck-field]"),f=i.find('[duck-button="edit"]'),p=i.find('[duck-button="cancel"]'),s=u&&u.table||i.attr("duck-table"),y=u&&u.crud||i.attr("duck-function"),v=u&&u.key||i.attr("duck-key"),b=u&&u.keyValue||i.attr("duck-key-value"),m=i.find('[duck-field="url"] input'),h=u&&u.successCallback||function(){n.location.reload(!0)},w=u&&u.failureCallBack||function(){n.location.reload(!0)};m.length&&k(m,i.find('[duck-field="name"] input')),s&&y&&v&&("update"!==y&&"delete"!==y||b)&&(f.click(function(){i.attr("duck-edit-form","view"===i.attr("duck-edit-form")?"edit":"view")}),p.click(function(){i.attr("duck-edit-form","view"===i.attr("duck-edit-form")?"edit":"view")}),i.on("click",'[duck-button="submit"]',function(c){switch(c.preventDefault(),c.stopPropagation(),e(c.currentTarget).prop("disabled",!0),y){case"add":var o={};o[v]=b||t.uuid(),t(s).add(l(o,d),h,w);break;case"update":t(s).get({field:v,value:b,findOne:!0},function(e){var n=l(e,d);t(s).update(n,h,w)});break;case"delete":t(s).delete(b,function(){var e=n.location.href.split("/"),t=i.attr("duck-goTo");e[e.length-1]?e.pop():(e.pop(),e.pop());var c=t?t:e.join("/");n.location.href===c?n.location.reload(!0):n.location.href=c});break;case"deleteField":var r=function(){var e=i.attr("duck-delete-path"),n=i.attr("duck-delete-value");return t(s).get({field:v,value:b,findOne:!0},function(c){var o=a(c,e,n);t(s).update(o,h,w)}),"break"}();if("break"===r)break}}),i.find('[duck-type="array"]').each(function(n,a){var r=e(a),u=r.find('[duck-button="add"]');u.off("click",o).click(o).off("mousedown",t.stopProp).on("mousedown",t.stopProp),r.find("> [duck-type]").each(function(n,o){var a=e(o),r=a.find('[duck-button="delete"]');r.off("click",c).click(c).off("mousedown",t.stopProp).on("mousedown",t.stopProp)})}).sortable("[duck-type]").find('[duck-value], [duck-type="wysiwyg"]').on("mousedown",t.stopProp))}e.fn.duckForm=function(e){return this.each(function(t,n){p(n,e)})},e(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=duckForm.min.js.map
