"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,n){function a(){e(this).parent().remove()}function c(){var t=e(this),n=t.parent(),r=n.find("> [duck-type]").first(),u=r.clone();u.find("[duck-value]").val(null),"object"===r.attr("duck-type")&&(u.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),u.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote({height:150}),u.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove()),u.append(e("<button>",{text:"Delete",class:"btn btn-danger btn-small","duck-button":"add",type:"button",click:a})),u.find('[duck-button="add"]').click(c),t.before(u)}function r(e,t,n){for(var a="string"==typeof t?t.split("."):t,c=a.length,u=function(t){var u=a[t],i=1===c,o="object"===_typeof(e[u]);if(i&&!o)delete e[u];else if(!o)return"break";var d=e[u]instanceof Array?"array":"object";if("object"===d){var f=a.slice(0);f.splice(0,1),e[u]=r(e[u],f,n)}else{var l=i?e[u].indexOf(n):e[u].map(function(e){return e[a[t+1]]}).indexOf(n);e[u].splice(l,1)}},i=0;i<c;i++){var o=u(i);if("break"===o)break}return e}function u(n,a){return a.each(function(a,c){var r=e(c),i=r.attr("duck-field"),o=r.attr("duck-type");switch(o){case"object":var d=r.attr("duck-key"),f=n[i]||{};d&&!f[d]&&(f[d]=r.attr("duck-key-value")||t.uuid()),n[i]=u(f,r.find("> [duck-field]"));break;case"array":var l=function(){var a=r.find('> [duck-type="object"]'),c=a.first().attr("duck-key")?n[i]:[];return a.length?a.each(function(n,a){var r=e(a),i=r.attr("duck-key"),o={};if(i){o[i]=r.attr("duck-key-value")||t.uuid();var d=c.map(function(e){return e[i]}).indexOf(o[i]);d!==-1&&c.splice(d,1)}c.push(u(o,r.find("> [duck-field]")))}):r.find("[duck-value]").each(function(t,n){var a=e(n).val();a&&c.push(a)}),c.length&&(n[i]=c),"break"}();if("break"===l)break;case"checkbox":var p=function(){var t=[];return r.find('input[type="checkbox"]').each(function(n,a){var c=e(a);c.prop("checked")&&t.push(c.val())}),t.length&&(n[i]=t),"break"}();if("break"===p)break;case"radio":var k=r.find('input[type="radio"]:checked').val();k&&(n[i]=k);break;case"bool":n[i]=r.prop("checked")||r.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":var s=r.find(".summernote").summernote("code");s&&(n[i]=s);break;case"select":case"number":case"string":default:var b=r.val(),v=b?b:r.find("[duck-value]").val();v&&(n[i]=v)}}),n}function i(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase())})}function o(o){var d=e(o),f=d.find("> [duck-field]"),l=d.find('[duck-button="submit"]'),p=d.attr("duck-table"),k=d.attr("duck-function"),s=d.attr("duck-key"),b=d.attr("duck-key-value"),v=d.find('[duck-field="url"]'),y=v.find("input"),h=d.find('[duck-field="name"] input');y.length&&i(y,h),p&&k&&s&&("update"!==k&&"delete"!==k||b)&&(l.click(function(e){switch(e.preventDefault(),e.stopPropagation(),l.prop("disabled",!0),k){case"add":var a={};a[s]=b||t.uuid(),t(p).add(u(a,f),function(){n.location.reload(!0)});break;case"update":t(p).get({field:s,value:b,findOne:!0},function(e){var a=u(e,f);t(p).update(a,function(){n.location.reload(!0)})});break;case"delete":t(p).delete(b,function(){var e=n.location.href.split("/"),t=d.attr("duck-goTo");e[e.length-1]?e.pop():(e.pop(),e.pop());var a=t?t:e.join("/");n.location.href===a?n.location.reload(!0):n.location.href=a});break;case"deleteField":var c=function(){var e=d.attr("duck-delete-path"),a=d.attr("duck-delete-value");return t(p).get({field:s,value:b,findOne:!0},function(c){var u=r(c,e,a);t(p).update(u,function(){n.location.reload(!0)})}),"break"}();if("break"===c)break}}),d.find('[duck-type="array"]').each(function(t,n){var r=e(n),u=e("<button>",{text:"Add "+r.attr("duck-field"),class:"btn btn-primary btn-small","duck-button":"add",type:"button",click:c});r.append(u),r.find("> [duck-type]").each(function(t,n){if(0!==t){var c=e(n),r=e("<button>",{text:"Delete",class:"btn btn-danger btn-small","duck-button":"delete",click:a});c.append(r)}})}))}e.fn.duckForm=function(){return this.each(function(e,t){o(t)})},e(n).load(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=duckForm.min.js.map
